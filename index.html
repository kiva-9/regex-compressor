<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web路径处理工具集</title>
    
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzRhNTU2OCI+PHBhdGggZD0iTTEyIDJBNCA0IDAgMCAwIDggNkg1djJIONEgdi0ySDJ2NmgydjJINGV2MmgxLjA5OGMuNDQyIDMuMzkgMy41IDYgNi45MDIgNnM2LjQ2LTIuNjEgNi45MDItNkgyMHYtMmgxdi0ySDIwVjhoLTNBNCA0IDAgMCAwIDEyIDJ6bTAgMmMxLjEgMCAyIC45IDIgMnMtLjkgMi0yIDJzLTItLjktMi0yIC45LTIgMi0yem0tMSAxMi43NjVWMTVIMTJWOWgtMXY3aC4yMjRDMTAuNDQgMTcuMTkgMTEuMzMgMTggMTIgMThzMS41Ni0uODEgMS43NzYtMkgxNFY5aC0xdjZoLjc2NEMxMy4zMyAxNi4wMyAxMy4wNCAxNyAxMiAxN3MtMS4zMy0uOTctMS43NjUtMkgyek0xNyA4djZoMVY4aC0xem0tMyAwaDF2NmgxVjhoLTJ6Ij48L3BhdGg+PC9zdmc+">
    
    <style>
        /* CSS 样式 (无变化) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f9;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto 40px auto;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 40px;
        }
        h2 {
            color: #1a73e8;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            font-family: monospace;
            box-sizing: border-box;
            margin-bottom: 1em;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            white-space: pre-wrap;
            word-break: break-all;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        button {
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            color: white;
        }
        .input-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .input-box {
            flex: 1;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 25px 0;
        }
        /* --- 按钮样式 --- */
        #regex-gen-btn {
            background-color: #5e35b1;
        }
        #regex-gen-btn:hover {
            background-color: #4527a0;
        }
        #process-btn {
            background-color: #1a73e8;
        }
        #process-btn:hover {
            background-color: #1558b8;
        }
        #copy-btn {
            background-color: #28a745;
            display: none;
        }
        #copy-btn:hover {
            background-color: #218838;
        }
        /* --- 结果区域 --- */
        .result-container {
            margin-top: 20px;
        }
        #result-table {
            width: 100%;
            border-collapse: collapse;
        }
        #result-table th, #result-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            word-break: break-all;
        }
        #result-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        #result-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .status-message {
            text-align: center;
            font-style: italic;
            margin-top: 15px;
            color: #666;
        }
    </style>
</head>
<body>

    <h1>Web路径处理工具集</h1>

    <div class="container">
        <h2>工具一：路径正则表达式生成器</h2>
        <p>粘贴完整 URL (每行一个)，工具将提取相同域名并生成匹配这些路径的正则表达式。</p>
        <textarea id="urlInput" rows="10" placeholder="https://www.example.com/blogs/lifestyle/page-a&#10;https://www.example.com/blogs/knowledge/page-b"></textarea>
        <div style="text-align: center;">
            <button id="regex-gen-btn" onclick="generateRegex()">生成正则表达式</button>
        </div>
        <h3>生成的正则表达式</h3>
        <pre id="regexOutput">(等待生成...)</pre>
    </div>

    <div class="container">
        <h2>工具二：URL点击量匹配工具</h2>
        <div class="input-container">
            <div class="input-box">
                <h3>1. 粘贴URL列表1 (保持此顺序，通常从文章数据表粘贴)</h3>
                <p>每行一个URL，点击量列可为空。</p>
                <textarea id="list1" rows="12" placeholder="示例:&#10;https://example.com/pageA&#10;https://example.com/pageB&#10;https://example.com/pageC"></textarea>
            </div>
            <div class="input-box">
                <h3>2. 粘贴URL列表2 (带点击量，通常从GSC导出数据粘贴)</h3>
                <p>从Excel或表格复制，第一列是URL，第二列是点击量。</p>
                <textarea id="list2" rows="12" placeholder="示例:&#10;https://example.com/pageC	985&#10;https://example.com/pageA	1230&#10;https://example.com/pageB	456"></textarea>
            </div>
        </div>
        <div class="controls">
            <button id="process-btn">开始匹配</button>
            <button id="copy-btn">仅复制点击量</button>
        </div>
        <div class="result-container">
            <h3>3. 匹配结果</h3>
            <div id="output">
                <p class="status-message">结果将在这里显示。</p>
            </div>
        </div>
    </div>

    <script>
        // --- 脚本1: 正则表达式生成器 (无变化) ---
        function escapeRegex(str) {
            return str.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
        }

        function generateRegex() {
            const input = document.getElementById('urlInput').value.trim();
            const urls = input.split('\n').map(line => line.trim()).filter(Boolean);
            if (urls.length === 0) {
                document.getElementById('regexOutput').textContent = '请输入至少一个 URL';
                return;
            }
            
            try {
                const urlObj = new URL(urls[0]);
                const base = urlObj.origin; 
                
                const paths = urls.map(url => {
                    try {
                        const u = new URL(url);
                        if (u.origin !== base) {
                           console.warn(`URL ${url} 的域名与第一个URL不符，已忽略。`);
                           return null;
                        }
                        return escapeRegex(u.pathname.replace(/^\/|\/$/g, ''));
                    } catch (e) {
                        return null;
                    }
                }).filter(Boolean);

                if (paths.length === 0) {
                    document.getElementById('regexOutput').textContent = '未能提取到有效的路径。';
                    return;
                }

                const regex = `^${escapeRegex(base)}\/(${paths.join('|')})\/?$`;
                document.getElementById('regexOutput').textContent = regex;
                
            } catch (e) {
                document.getElementById('regexOutput').textContent = '错误：请输入有效的URL。第一个URL格式不正确。';
            }
        }

        // --- 脚本2: URL点击量匹配工具 (无变化) ---
        document.getElementById('process-btn').addEventListener('click', () => {
            const list1Text = document.getElementById('list1').value.trim();
            const list2Text = document.getElementById('list2').value.trim();

            if (!list1Text || !list2Text) {
                document.getElementById('output').innerHTML = '<p class="status-message" style="color: red;">错误：两个列表都必须填写内容。</p>';
                return;
            }

            const clicksMap = new Map();
            const list2Lines = list2Text.split('\n');
            
            list2Lines.forEach(line => {
                if (line.trim() === '') return;
                const parts = line.split(/\s+/);
                if (parts.length >= 2) {
                    const url = parts[0].trim();
                    const clicks = parts[parts.length - 1].trim();
                    if (url) {
                       clicksMap.set(url, clicks);
                    }
                }
            });

            const results = [];
            const list1Lines = list1Text.split('\n');
            let notFoundCount = 0;

            list1Lines.forEach(line => {
                if (line.trim() === '') return;
                const url = line.split(/\s+/)[0].trim();
                if (url) {
                    const clicks = clicksMap.get(url);
                    if (clicks !== undefined) {
                        results.push({ url: url, clicks: clicks });
                    } else {
                        results.push({ url: url, clicks: '未找到' });
                        notFoundCount++;
                    }
                }
            });

            renderTable(results, notFoundCount);
            
            if(results.length > 0) {
                document.getElementById('copy-btn').style.display = 'inline-block';
            } else {
                document.getElementById('copy-btn').style.display = 'none';
            }
        });

        function renderTable(data, notFoundCount) {
            const outputDiv = document.getElementById('output');
            if (data.length === 0) {
                outputDiv.innerHTML = '<p class="status-message">未能处理任何数据，请检查输入格式。</p>';
                return;
            }

            let tableHTML = `
                <p class="status-message">
                    处理完成！共处理 <strong>${data.length}</strong> 条URL，其中 <strong>${notFoundCount}</strong> 条未在列表2中找到匹配项。
                </p>
                <table id="result-table">
                    <thead>
                        <tr>
                            <th>URL (顺序来自列表1)</th>
                            <th>匹配到的点击量</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(item => {
                tableHTML += `
                    <tr>
                        <td>${item.url}</td>
                        <td>${item.clicks}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            outputDiv.innerHTML = tableHTML;
        }

        document.getElementById('copy-btn').addEventListener('click', () => {
            const table = document.getElementById('result-table');
            if (!table) return;

            const clicksColumn = [];
            for (let i = 1; i < table.rows.length; i++) {
                const row = table.rows[i];
                const clickCount = row.cells[1].innerText;
                clicksColumn.push(clickCount);
            }
            
            const clicksContent = clicksColumn.join('\n');

            navigator.clipboard.writeText(clicksContent).then(() => {
                const copyBtn = document.getElementById('copy-btn');
                const originalText = copyBtn.innerText;
                copyBtn.innerText = '复制成功!';
                copyBtn.style.backgroundColor = '#218838';
                setTimeout(() => {
                    copyBtn.innerText = originalText;
                    copyBtn.style.backgroundColor = '#28a745';
                }, 2000);
            }).catch(err => {
                alert('复制失败: ' + err);
            });
        });
    </script>

</body>
</html>